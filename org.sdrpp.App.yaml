id: org.sdrpp.App
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
command: sdrpp
finish-args:
  - --share=network
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=pulseaudio
  - --device=usb
  - --device=dri

modules:
  - name: fftw
    buildsystem: autotools
    config-opts:
      - --enable-float
      - --enable-shared
    sources:
      - type: archive
        url: http://www.fftw.org/fftw-3.3.10.tar.gz
        sha256: 56c932549852cddcfafdab3820b0200c7742675be92179e59e6215b340e26467

  - name: volk
    buildsystem: cmake
    sources:
      - type: git
        url: https://github.com/gnuradio/volk.git
        tag: v3.2.0

  - name: glfw
    buildsystem: cmake
    config-opts:
      - -DGLFW_BUILD_WAYLAND=ON
      - -DGLFW_BUILD_X11=ON
      - -DBUILD_SHARED_LIBS=ON
    sources:
      - type: git
        url: https://github.com/glfw/glfw.git
        tag: '3.4'

  - name: libusb
    buildsystem: autotools
    sources:
      - type: archive
        url: https://github.com/libusb/libusb/releases/download/v1.0.27/libusb-1.0.27.tar.bz2
        sha256: ffaa41d741a8a3bee244ac8e54a72ea05bf2879663c098c82fc5757853441575

  - name: rtl-sdr
    buildsystem: cmake
    config-opts:
      - -DINSTALL_UDEV_RULES=OFF
      - -DDETACH_KERNEL_DRIVER=ON
    sources:
      - type: git
        url: https://github.com/rtlsdrblog/rtl-sdr-blog.git
        tag: v1.3.6

  - name: rtaudio
    buildsystem: cmake
    config-opts:
      - -DRTAUDIO_API_PULSE=ON
      - -DRTAUDIO_BUILD_STATIC_LIBS=OFF
      - -DBUILD_SHARED_LIBS=ON
    sources:
      - type: git
        url: https://github.com/thestk/rtaudio.git
        tag: '6.0.1'
  
  - name: codec2
    buildsystem: cmake
    builddir: true
    config-opts:
      - -DBUILD_SHARED_LIBS=ON
    sources:
      - type: git
        url: https://github.com/drowe67/codec2.git
        tag: '1.2.0'

  - name: sdrpp
    buildsystem: cmake
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DUSE_SYSTEM_FFTW=ON
      - -DUSE_SYSTEM_VOLK=ON
      - -DUSE_SYSTEM_GLFW=ON
      - -DOPT_BUILD_RTL_TCP_SOURCE=ON
      - -DOPT_BUILD_RTL_SDR_SOURCE=ON
      - -DOPT_BUILD_AIRSPY_SOURCE=OFF
      - -DOPT_BUILD_AIRSPYHF_SOURCE=OFF
      - -DOPT_BUILD_HACKRF_SOURCE=OFF
      - -DOPT_BUILD_SOAPY_SOURCE=OFF
      - -DOPT_BUILD_PLUTOSDR_SOURCE=OFF
      - -DOPT_BUILD_BLADERF_SOURCE=OFF
      - -DOPT_BUILD_M17_DECODER=ON
    sources:
      - type: git
        url: https://github.com/AlexandreRouma/SDRPlusPlus.git
        branch: master
      - type: patch
        path: remove-stdc++fs.patch

  - name: sdrpp-desktop
    buildsystem: simple
    build-commands:
      - install -D org.sdrpp.App.desktop /app/share/applications/org.sdrpp.App.desktop
      - install -D org.sdrpp.App.png /app/share/icons/hicolor/256x256/apps/org.sdrpp.App.png
      - install -D org.sdrpp.App.metainfo.xml /app/share/metainfo/org.sdrpp.App.metainfo.xml
    sources:
      - type: file
        path: org.sdrpp.App.desktop
      - type: file
        path: org.sdrpp.App.png
      - type: file
        path: org.sdrpp.App.metainfo.xml
